# default installation location:
#   binaries: /usr/local/bin
#   module  : /usr/local/lib/site_perl
prefix="/usr/local"
libpath="lib/site_perl"

# the place where *I* keep the sources of arename's "website".
# The whole updatewebsite-fu is probably not useful for anybody else.
ikiroot=/home/hawk/src/web/ft/comp
ikisubroot=/home/hawk/src/web/subpages.ft/comp/arename

all:
	@printf 'Makefile targets intended for users:\n'
	@printf '  all            this text\n'
	@printf '  install        install both scripts and the module\n'
	@printf '  install-doc    install html and nroff manual\n'
	@printf '\nAll other targets are not for you. Stay away!\n'

dev-help: all
	@printf '\nMakefile targets intended for developers:\n'
	@printf 'DO NOT USE THESE UNLESS YOU KNOW WHAT YOU ARE DOING!\n'
	@printf '  arename.1      generate manpage\n'
	@printf '  arename.html   generate manpage in html format\n'
	@printf '  doc            generate arename.1 and arename.html\n'
	@printf '  dev-help       this text\n'
	@printf '  clean          clean up working tree\n'
	@printf '  distclean      same as clean, but removes .tars, too\n'
	@printf '  updateweb      update the autogenerated website\n'
	@printf '  removeweb      clean up the website'\''s target directory\n'

doc: arename.1 arename.html

arename.1: arename.pl
	pod2man  ./arename.pl > arename.1    2>/dev/null

arename.html: arename.pl
	pod2html ./arename.pl > arename.html 2>/dev/null
	@rm -f *.tmp

clean:
	rm -f arename.html arename.1 *.tmp *~

distclean: clean
	rm -f *.tar.gz

install:
	@printf 'Installing arename.pl    to %s\n' "$(prefix)/bin"
	@cp arename.pl    "$(prefix)/bin/"
	@printf 'Installing ataglist.pl   to %s\n' "$(prefix)/bin"
	@cp ataglist.pl   "$(prefix)/bin/"
	@chown root:root  "$(prefix)/bin/arename.pl" "$(prefix)/bin/ataglist.pl"
	@chmod 0755       "$(prefix)/bin/arename.pl" "$(prefix)/bin/ataglist.pl"
	@printf 'Installing ARename.pm    to %s\n' "$(prefix)/$(libpath)/"
	@[ ! -d "$(prefix)/$(libpath)" ] && (mkdir -p "$(prefix)/$(libpath)" && chmod 0755 "$(prefix)/$(libpath)" ) || true
	@cp ARename.pm    "$(prefix)/$(libpath)"
	@chmod 0644       "$(prefix)/$(libpath)/ARename.pm"

install-doc: doc
	@printf 'Installing arename.1     to %s\n' "$(prefix)/share/man/man1"
	@cp arename.1     "$(prefix)/share/man/man1/"
	@chown root:root  "$(prefix)/share/man/man1/arename.1"
	@chmod 0644       "$(prefix)/share/man/man1/arename.1"
	@printf 'Installing arename.html  to %s\n' "$(prefix)/share/doc/arename"
	@mkdir -p         "$(prefix)/share/doc/arename"
	@chmod 0755       "$(prefix)/share/doc/arename"
	@cp arename.html  "$(prefix)/share/doc/arename/"
	@chown root:root  "$(prefix)/share/doc/arename/arename.html"
	@chmod 0644       "$(prefix)/share/doc/arename/arename.html"
	@printf 'Installing arename.hooks to %s\n' "$(prefix)/share/doc/arename/examples"
	@mkdir -p         "$(prefix)/share/doc/arename/examples"
	@chmod 0755       "$(prefix)/share/doc/arename/examples"
	@cp arename.hooks "$(prefix)/share/doc/arename/examples"
	@chown root:root  "$(prefix)/share/doc/arename/examples/arename.hooks"
	@chmod 0644       "$(prefix)/share/doc/arename/examples/arename.hooks"

updateweb:
	@printf 'Updating webpages...\n'
	@./updatewebsite.sh "$(ikiroot)" "$(ikisubroot)"
	make distclean

removeweb:
	@printf 'Remove webpages...\n'
	rm -f "$(ikiroot)"/arename.mdwn "$(ikisubroot)"/*

.PHONY: install install-doc distclean clean all doc
